<?xml version="1.0" encoding="UTF-8"?>
<launch>
    <!-- RUN ONLY WHILE RUNNING THE gazebo.launch -->
    <arg name="name" default="bot"/>

    <arg name="lanes_mono" default="1"/>

    <arg name="rviz" default="1"/>
    <arg name="reconfigure" default="0"/>


    <!-- Spawn Bot -->
    <node pkg="rosservice" type="rosservice" name="bot_killer" args="call /gazebo/delete_model $(arg name)"/>
    <include file="$(find igvc_bot)/launch/helper/spawn.launch">
        <arg name="name" value="$(arg name)"/>
    </include>


    <!-- Camera Based Detection -->
    <node name="img_proc_left" pkg="image_proc" type="image_proc" ns="/camera/left" if="$(arg lanes_mono)"/>
    <node name="stereo_processor" ns="camera" pkg="stereo_image_proc" type="stereo_image_proc"
          unless="$(arg lanes_mono)"/>

    <node ns="camera/left" pkg="igvc_bot" type="lanes_mono" name="lanes_mono" output="screen" if="$(arg lanes_mono)">
        <rosparam command="load" file="$(find igvc_bot)/params/lanes_mono.yaml"/>
    </node>


    <!-- Nav Stack -->
    <node name="map_to_odom_transform" pkg="tf2_ros" type="static_transform_publisher" args="0 0 0 0 0 0 map odom"/>

    <node pkg="move_base" type="move_base" name="move_base">
        <rosparam command="load" file="$(find igvc_bot)/params/base_local_planner.yaml"/>
        <rosparam command="load" file="$(find igvc_bot)/params/costmap_common.yaml" ns="global_costmap"/>
        <rosparam command="load" file="$(find igvc_bot)/params/costmap_common.yaml" ns="local_costmap"/>
        <rosparam command="load" file="$(find igvc_bot)/params/costmap_global.yaml"/>
        <rosparam command="load" file="$(find igvc_bot)/params/costmap_local.yaml"/>
    </node>

    <!-- rviz -->
    <node name="$(arg name)-rviz" pkg="rviz" type="rviz" if="$(arg rviz)"
          args="-d $(find igvc_bot)/rviz/view_robot.rviz"/>

    <!-- DynamicReconfigure -->
    <node name="$(arg name)-dynamic_reconfigure" pkg="rqt_reconfigure" type="rqt_reconfigure" if="$(arg reconfigure)"/>
</launch>

